# Architecture Overview

This document describes the architecture and design patterns used in Maneel Club.

## ğŸ—ï¸ System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Client (Browser)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  Storefront  â”‚  â”‚    Admin     â”‚  â”‚   Dashboard â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ HTTP/HTTPS
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Next.js Application                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              App Router (Next.js 16)                 â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚
â”‚  â”‚  â”‚   Pages    â”‚  â”‚ API Routes â”‚  â”‚  Server    â”‚    â”‚  â”‚
â”‚  â”‚  â”‚            â”‚  â”‚            â”‚  â”‚  Actions   â”‚    â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              React Server Components                  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚
â”‚  â”‚  â”‚ Components â”‚  â”‚   Hooks    â”‚  â”‚   Stores   â”‚    â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ Prisma ORM
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PostgreSQL Database                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  Products  â”‚  â”‚   Orders   â”‚  â”‚   Users    â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ API Calls
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  External Services                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  ImageKit  â”‚  â”‚ Better Authâ”‚  â”‚   Meta     â”‚         â”‚
â”‚  â”‚    CDN     â”‚  â”‚            â”‚  â”‚   Pixel    â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ Project Structure

```
maneelclub/
â”œâ”€â”€ prisma/                    # Database layer
â”‚   â”œâ”€â”€ schema.prisma          # Prisma schema definition
â”‚   â”œâ”€â”€ migrations/            # Database migrations
â”‚   â””â”€â”€ seed.ts                # Database seeding script
â”‚
â”œâ”€â”€ public/                    # Static assets
â”‚   â”œâ”€â”€ assets/               # Images, icons, etc.
â”‚   â””â”€â”€ uploads/               # Local file uploads (fallback)
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/                  # Next.js App Router
â”‚   â”‚   â”œâ”€â”€ (admin)/          # Admin routes (protected)
â”‚   â”‚   â”œâ”€â”€ (shop)/           # Storefront routes
â”‚   â”‚   â”œâ”€â”€ (auth)/           # Authentication routes
â”‚   â”‚   â”œâ”€â”€ (dashboard)/      # User dashboard routes
â”‚   â”‚   â”œâ”€â”€ api/              # API routes
â”‚   â”‚   â””â”€â”€ layout.tsx         # Root layout
â”‚   â”‚
â”‚   â”œâ”€â”€ actions/               # Server actions
â”‚   â”‚   â”œâ”€â”€ admin/            # Admin-specific actions
â”‚   â”‚   â”œâ”€â”€ orders.ts         # Order actions
â”‚   â”‚   â””â”€â”€ profile.ts         # User profile actions
â”‚   â”‚
â”‚   â”œâ”€â”€ components/            # React components
â”‚   â”‚   â”œâ”€â”€ admin/             # Admin components
â”‚   â”‚   â”œâ”€â”€ layout/           # Layout components
â”‚   â”‚   â””â”€â”€ ui/               # Reusable UI components
â”‚   â”‚
â”‚   â”œâ”€â”€ lib/                   # Utility libraries
â”‚   â”‚   â”œâ”€â”€ auth.ts           # Better Auth configuration
â”‚   â”‚   â”œâ”€â”€ storage.ts        # Storage service abstraction
â”‚   â”‚   â”œâ”€â”€ constants.ts      # App constants
â”‚   â”‚   â””â”€â”€ settings.ts       # Settings management
â”‚   â”‚
â”‚   â”œâ”€â”€ schemas/               # Zod validation schemas
â”‚   â”œâ”€â”€ store/                 # Zustand stores
â”‚   â””â”€â”€ types/                 # TypeScript type definitions
â”‚
â”œâ”€â”€ .env.example               # Environment variables template
â”œâ”€â”€ next.config.ts             # Next.js configuration
â”œâ”€â”€ package.json               # Dependencies and scripts
â””â”€â”€ tsconfig.json              # TypeScript configuration
```

## ğŸ”„ Data Flow

### 1. Request Flow

```
User Action
    â†“
React Component
    â†“
Server Action / API Route
    â†“
Prisma ORM
    â†“
PostgreSQL Database
    â†“
Response
    â†“
React Component Update
```

### 2. Authentication Flow

```
Login Request
    â†“
Better Auth API
    â†“
Session Creation
    â†“
Cookie Set
    â†“
Protected Route Access
```

### 3. Image Upload Flow

```
File Upload
    â†“
Server Action
    â†“
Storage Service (ImageKit/MinIO/Local)
    â†“
URL Returned
    â†“
Database Update
```

## ğŸ¨ Design Patterns

### Server Actions Pattern

Server actions are used for mutations and data updates:

```typescript
// src/actions/admin/products.ts
"use server"

export async function createProduct(data: ProductInput) {
  // Server-side logic
  const product = await prisma.product.create({ data })
  return product
}
```

### Component Composition

Components are composed using Radix UI primitives:

```typescript
// Reusable UI components
<Button variant="default" size="lg">
  Click me
</Button>
```

### State Management

- **Server State**: Prisma queries and server actions
- **Client State**: Zustand stores for cart and UI state
- **Form State**: React Hook Form for form management

## ğŸ” Security Architecture

### Authentication

- Better Auth handles authentication
- Session-based authentication
- Rate limiting on auth endpoints
- Password hashing with bcrypt

### Authorization

- Role-based access control (ADMIN, CUSTOMER)
- Protected routes with middleware
- Server-side permission checks

### Data Validation

- Zod schemas for input validation
- Type-safe database queries with Prisma
- SQL injection prevention via Prisma

## ğŸ“¦ Storage Architecture

### Multi-Storage Support

The platform supports multiple storage backends with automatic fallback:

1. **ImageKit** (Primary)
   - CDN with automatic optimization
   - URL transformations
   - Pre-compression on upload

2. **MinIO** (Fallback)
   - S3-compatible storage
   - Self-hosted option

3. **Local Filesystem** (Fallback)
   - `public/uploads/` directory
   - Development and testing

### Storage Service Abstraction

```typescript
// src/lib/storage.ts
interface StorageService {
  upload(file: Buffer, key: string, contentType: string): Promise<string>
  getPublicUrl(key: string): string
}
```

## ğŸš€ Performance Optimizations

### Server-Side Rendering

- React Server Components for initial render
- Reduced client-side JavaScript
- Faster Time to First Byte (TTFB)

### Image Optimization

- ImageKit CDN for automatic optimization
- Next.js Image component for lazy loading
- Responsive image sizes

### Code Splitting

- Automatic code splitting by Next.js
- Route-based code splitting
- Dynamic imports for heavy components

### Caching Strategy

- Static page generation where possible
- Database query optimization
- CDN caching for static assets

## ğŸ”„ State Management

### Server State

- Prisma queries for data fetching
- Server actions for mutations
- React Server Components for rendering

### Client State

- Zustand for cart state
- React Hook Form for form state
- URL state for filters and search

## ğŸ“Š Database Schema

See [Database Schema](Database-Schema) for detailed information about:
- Entity relationships
- Indexes and constraints
- Migration strategy

## ğŸ”Œ API Architecture

### API Routes

- RESTful API routes in `src/app/api/`
- Server actions for mutations
- Type-safe API responses

### External Integrations

- ImageKit API for image management
- Better Auth API for authentication
- Meta Pixel API for analytics

---

## ğŸ“š Related Documentation

- [Database Schema](Database-Schema)
- [API Reference](API-Reference)
- [Configuration](Configuration)

---

*Last updated: February 2026*
